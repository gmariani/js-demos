var cv=cv||{};cv.Request=function(b){for(var c=0,a=this.eventList.length;c<a;c++){this._callbacks[this.eventList[c]]=[]}this.xhr=new XMLHttpRequest();this.headers=b.headers||this.headers};cv.Request.VERSION=1;cv.Request.prototype={options:{url:"",data:"",user:null,pass:null,headers:{"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*"},async:true,urlEncoded:true,encoding:"utf-8",noCache:false,method:"POST",contentType:null},_callbacks:{},eventList:["focus","blur","change","init","destroy"],running:false,response:null,status:null,setHeader:function(a,b){this.headers[a]=b;return this},getHeader:function(a){try{return this.xhr.getResponseHeader(a)}catch(b){return this.headers[a]||null}},cancel:function(){if(!this.running){return this}this.running=false;this.status=null;this.xhr.abort();this.xhr.onreadystatechange=null;this.xhr=new XMLHttpRequest();this.callBack("cancel");return this},send:function(l){if(this.running){return}this.running=true;if(typeof(l)==="string"||typeof(l)==="element"){l={data:l}}l.data=l.data||this.options.data;l.url=l.method||this.options.url;l.method=l.method||this.options.method;l.user=l.user||this.options.user;l.pass=l.pass||this.options.pass;var h=l.data,b=l.url,f=l.user,k=l.pass,a=l.method.toUpperCase(),c,j,g,d=b.lastIndexOf("/");if(this.options.urlEncoded&&a==="POST"){c=(this.options.encoding)?"; charset="+this.options.encoding:"";this.headers["Content-type"]="application/x-www-form-urlencoded"+c}if(this.options.noCache){j="noCache="+new Date().getTime();h=(h)?j+"&"+h:j}if(d>-1&&(d=b.indexOf("#"))>-1){b=b.substr(0,d)}if(h&&a==="GET"){b=b+(b.contains("?")?"&":"?")+h;h=null}this.xhr.open(a,b,this.options.async,f,k);this.xhr.onreadystatechange=this.onStateChange;if(this.options.contentType){if(this.xhr.overrideMimeType){this.xhr.overrideMimeType(this.options.contentType)}else{if(this.xhr.contentType){this.xhr.contentType=this.options.contentType}}}for(g in this.headers){try{this.xhr.setRequestHeader(g,this.headers[g])}catch(e){}}this.xhr.send(h);if(!this.options.async){this.onStateChange()}return this},onStateChange:function(){switch(this.xhr.readyState){case 0:break;case 1:break;case 2:this.status=this.xhr.status||0;this.callBack("status");break;case 3:this.callBack("progress");break;case 4:this.xhr.onreadystatechange=null;if(this.xhr.status===200){this.response={text:this.xhr.responseText,xml:this.xhr.responseXML};this.callBack("complete")}else{this.response={text:null,xml:null};this.callBack("error")}break}},callBack:function(b){var a,d,g={text:this.response.text,xml:this.response.xml,status:this.status};try{for(a=0;d=this._callbacks[b][a];a++){d(g)}}catch(c){trace("Request::callBack :",c)}},addCallBack:function(b,a){if(this._callbacks[b]){return this._callbacks[b].push(a)}return NaN},removeCallBack:function(d,b){if(this._callbacks[d]){var a=this._callbacks[d],c;if(a[b]){c=a.slice(b+1);a.length=b;a.push.apply(a,c);return true}else{return false}}return false}};